# 要件定義書（リファイン版 v1.1）

---

## 0. 概要

Google Spreadsheet から取得した打撃成績を基に、ブラウザ上で 9 人の打順をヒューリスティック最適化し、シミュレーションによる平均得点を可視化する Web アプリを提供する。

### 0.1 実装状況

*TODO*

---

## 1. 利用者像

| ID     | ペルソナ（利用端末）            | ニーズ                                             |
| ------ | --------------------- | ----------------------------------------------- |
| **U1** | 野球好きのエンジニア／学生（PC・スマホ） | 自作の Google Spreadsheet を読み込み、成績を見ながら手動で打線を編成したい |
| **U2** | 野球好きのエンジニア／学生（PC・スマホ） | 作成した打線について、指定回数の試合シミュレーションを実行し、平均得点・分散を確認したい    |
| **U3** | 野球好きのエンジニア／学生（PC・スマホ） | 打線を自動で微調整しながらシミュレーションを行い、平均得点が最大となる打順を生成したい     |

---

## 2. ユーザーストーリー

### US-01 外部データを読み込み表示できる

**受入基準**

| 手順 | WHEN                                                  | THEN                                        |
| -- | ----------------------------------------------------- | ------------------------------------------- |
| 1  | アプリを開く                                                | デフォルトで日本プロ野球データを読み込み、選手成績を指定形式で表示する         |
| 2  | データ URL 入力欄に自作 Google Spreadsheet の URL を入力し「読み込み」を押す | 形式が正しければデータを表示し、異なる場合はエラーメッセージを表示する         |
| 3  | チーム名プルダウンでチームを選択                                      | 選択チームの選手のみを表示する                             |
| 4  | 選手行の「選択」ボタンを押す                                        | 選手が打線に追加される（1 番から順に 9 番まで）。9 人未満時は「作成中…」と表示 |
| 5  | 9 人揃う                                                 | 右側固定領域に「作成完了」を表示し、「分析開始」ボタンを活性化             |
| 6  | 「リセット」ボタンを押す                                          | 打線を全消去する（個別解除も可）                            |

---

### US-02 外部データを再読み込みできる

**受入基準**

| 手順 | WHEN                                       | THEN                                                     |
| -- | ------------------------------------------ | -------------------------------------------------------- |
| 1  | URL 入力欄に新しい Google Spreadsheet の URL を入力する | —(デフォルトでは、NPBの選手データを入力済みのGoogle SpreadsheetのURLが記載されている) |
| 2  | 「読み込み」ボタンを押す                               | Google Spreadsheet を再読み込みし表示する。形式不一致・読込失敗時はエラーメッセージを表示する |

---

### US-03 試合シミュレーション結果を確認できる

**受入基準**

| 手順 | WHEN            | THEN                           |
| -- | --------------- | ------------------------------ |
| 1  | 「シミュレーション開始」を押す | 指定回数分の試合を乱数で再現し、平均・中央値・分散を表示する |
| 2  | 試合数を変更し再度実行     | 指定試合数（上限 10 000）で再シミュレーションする   |

---

### US-04 ヒューリスティックに最適打順を探索できる

**受入基準**

| 手順 | WHEN                           | THEN                            |
| -- | ------------------------------ | ------------------------------- |
| 1  | 「最適化」を開始し、入れ替え方法（**近隣／遠隔**）を選択 | エンジンが 1 箇所ずつ入れ替え、改善がなくなるまで探索する  |
| 2  | 探索中                            | 各入れ替え後の打順と平均得点を履歴テーブルに追記する      |
| 3  | 探索完了                           | 最高得点打順と平均得点をハイライトし、元打順との差分を表示する |

---

## 3. データ仕様

### 3.1 取得元

* ユーザが提示する Google Spreadsheet（Web 公開 CSV URL）

### 3.2 取り込みカラム（完全版）

\| チーム | 背番号 | 選手名 | 打率 | 試合 | 打席数 | 打数 | 得点 | 安打 | 二塁打 | 三塁打 | 本塁打 | 塁打 | 打点 | 盗塁 | 盗塁刺 | 犠打 | 犠飛 | 四球 | 敬遠 | 死球 | 三振 | 併殺打 | 出塁率 | 長打率 |

### 3.3 画面表示サブセット（加工後）

\| チーム | 選手名 | 打率 | 打席数 | 打数 | 単打率 | 二塁打率 | 三塁打率 | 本塁打率 | 四球・敬遠・死球率 | 三振率 |

---

## 4. 技術スタック

| レイヤ     | 採用技術                      |
| ------- | ------------------------- |
| フロントエンド | React + Vite + TypeScript |
| デプロイ    | GitHub Pages              |

